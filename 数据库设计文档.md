# 数据库设计文档

**项目名称：** 次世代多用户内容社区平台 / Corasta 
**数据库类型：** MySQL 8.0+  
**文档版本：** V1.0  
**最后更新：** 2024

---

## 目录

1. [数据库设计概述](#1-数据库设计概述)
2. [数据库命名规范](#2-数据库命名规范)
3. [核心实体关系图](#3-核心实体关系图)
4. [数据表详细设计](#4-数据表详细设计)
5. [索引设计](#5-索引设计)
6. [预留扩展说明](#6-预留扩展说明)

---

## 1. 数据库设计概述

### 1.1 设计原则

- **规范化设计：** 遵循数据库第三范式，减少数据冗余
- **性能优化：** 合理使用索引，优化查询性能
- **可扩展性：** 预留扩展字段，便于后续功能开发
- **易维护性：** 表名、字段名清晰易懂，注释完整
- **软删除：** 使用 `deleted_at` 字段实现软删除，保留历史数据

### 1.2 数据库结构

数据库包含以下主要模块：
- 用户模块（用户信息、认证、隐私设置）
- 内容模块（文章、问答、视频）
- 互动模块（评论、点赞、收藏、分享）
- 社交模块（关注、通知）
- 系统模块（分类、标签、配置）

### 1.3 开发阶段对应

- **第一阶段：** 用户、文章、问答、互动、社交相关表
- **第二阶段：** 视频、弹幕相关表
- **第三阶段：** 管理员操作日志、审核相关字段

---

## 2. 数据库命名规范

### 2.1 表命名规范

- 表名使用小写字母，多个单词用下划线分隔
- 表名使用复数形式（如 `users`, `articles`）
- 关联表使用两个表名组合（如 `article_tags`）

### 2.2 字段命名规范

- 字段名使用小写字母，多个单词用下划线分隔
- 主键统一使用 `id`
- 外键使用 `表名_id` 格式（如 `user_id`, `article_id`）
- 布尔类型字段使用 `is_` 前缀（如 `is_deleted`, `is_pinned`）
- 时间字段统一使用 `created_at`, `updated_at`, `deleted_at`

### 2.3 索引命名规范

- 主键索引：`PRIMARY`
- 唯一索引：`uk_表名_字段名`
- 普通索引：`idx_表名_字段名`
- 组合索引：`idx_表名_字段1_字段2`

---

## 3. 核心实体关系图

```
User (用户)
  ├── Article (文章) ── Category (分类)
  │     └── Tag (标签) [多对多]
  ├── Question (问题) ── Tag (标签) [多对多]
  │     └── Answer (回答)
  ├── Video (视频) [第二阶段]
  │     ├── Danmaku (弹幕) [第二阶段]
  │     └── Tag (标签) [多对多]
  ├── Comment (评论) ── 可关联 Article/Answer/Video
  ├── Like (点赞) ── 可关联 Article/Answer/Comment/Video
  ├── Favorite (收藏) ── FavoriteFolder (收藏夹)
  ├── Follow (关注关系)
  ├── Notification (通知)
  └── SecurityQuestion (密保问题)
```

---

## 4. 数据表详细设计

### 4.1 用户模块

#### 4.1.1 users（用户表）

**表说明：** 存储用户基本信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| username | VARCHAR | 20 | NOT NULL | - | 用户名（唯一） |
| password | VARCHAR | 255 | NOT NULL | - | 密码（明文存储） |
| nickname | VARCHAR | 20 | NULL | - | 昵称 |
| avatar | VARCHAR | 500 | NULL | - | 头像URL |
| bio | VARCHAR | 200 | NULL | - | 个人简介 |
| email | VARCHAR | 100 | NULL | - | 邮箱（预留） |
| phone | VARCHAR | 20 | NULL | - | 手机号（预留） |
| status | TINYINT | - | NOT NULL | 1 | 状态：0-封禁，1-正常（第三阶段） |
| role | TINYINT | - | NOT NULL | 0 | 角色：0-普通用户，1-超级管理员（第三阶段） |
| last_login_at | DATETIME | - | NULL | - | 最后登录时间 |
| last_login_ip | VARCHAR | 50 | NULL | - | 最后登录IP |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_users_username` (`username`)
- INDEX `idx_users_status` (`status`)
- INDEX `idx_users_created_at` (`created_at`)
- INDEX `idx_users_deleted_at` (`deleted_at`)

**备注：**
- `password` 字段当前使用明文存储（根据需求文档）
- `email` 和 `phone` 字段预留，用于后续扩展
- `status` 和 `role` 字段为第三阶段预留

#### 4.1.2 security_questions（密保问题表）

**表说明：** 存储用户的密保问题

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 用户ID |
| question | VARCHAR | 200 | NOT NULL | - | 问题内容 |
| answer | VARCHAR | 255 | NOT NULL | - | 答案（加密存储） |
| sort_order | TINYINT | - | NOT NULL | 0 | 排序顺序（1-3） |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_security_questions_user_id` (`user_id`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 每个用户最多3个密保问题
- `answer` 字段需要加密存储

#### 4.1.3 user_privacy_settings（用户隐私设置表）

**表说明：** 存储用户的隐私设置

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 用户ID（唯一） |
| homepage_visible | TINYINT | - | NOT NULL | 1 | 主页可见性：0-仅关注者，1-公开 |
| content_visible | TINYINT | - | NOT NULL | 1 | 内容可见性：0-仅关注者，1-公开 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_user_privacy_settings_user_id` (`user_id`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

---

### 4.2 内容模块

#### 4.2.1 categories（分类表）

**表说明：** 存储内容分类信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| name | VARCHAR | 50 | NOT NULL | - | 分类名称（唯一） |
| description | VARCHAR | 200 | NULL | - | 分类描述 |
| icon | VARCHAR | 200 | NULL | - | 分类图标（预留） |
| sort_order | INT | - | NOT NULL | 0 | 排序顺序 |
| parent_id | BIGINT | - | NULL | - | 父分类ID（预留，支持多级分类） |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_categories_name` (`name`)
- INDEX `idx_categories_parent_id` (`parent_id`)
- INDEX `idx_categories_deleted_at` (`deleted_at`)

**备注：**
- `parent_id` 字段预留，用于支持多级分类
- `icon` 字段预留，用于分类图标展示

#### 4.2.2 tags（标签表）

**表说明：** 存储标签信息，文章、问答、视频共用

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| name | VARCHAR | 50 | NOT NULL | - | 标签名称（唯一） |
| description | VARCHAR | 200 | NULL | - | 标签描述 |
| use_count | INT | - | NOT NULL | 0 | 使用次数 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_tags_name` (`name`)
- INDEX `idx_tags_use_count` (`use_count`)
- INDEX `idx_tags_deleted_at` (`deleted_at`)

**备注：**
- `use_count` 字段用于统计标签使用频率，便于热门标签推荐

#### 4.2.3 articles（文章表）

**表说明：** 存储文章信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 作者ID |
| title | VARCHAR | 100 | NOT NULL | - | 文章标题 |
| content | LONGTEXT | - | NOT NULL | - | 文章内容（Markdown） |
| summary | VARCHAR | 200 | NULL | - | 文章摘要 |
| cover_image | VARCHAR | 500 | NULL | - | 封面图URL |
| slug | VARCHAR | 100 | NULL | - | 自定义URL（SEO友好） |
| category_id | BIGINT | - | NULL | - | 分类ID |
| status | TINYINT | - | NOT NULL | 0 | 状态：0-草稿，1-已发布，2-私密 |
| view_count | INT | - | NOT NULL | 0 | 阅读量 |
| like_count | INT | - | NOT NULL | 0 | 点赞数 |
| comment_count | INT | - | NOT NULL | 0 | 评论数 |
| favorite_count | INT | - | NOT NULL | 0 | 收藏数 |
| share_count | INT | - | NOT NULL | 0 | 分享数 |
| is_top | TINYINT | - | NOT NULL | 0 | 是否置顶（预留） |
| audit_status | TINYINT | - | NOT NULL | 1 | 审核状态：0-待审核，1-通过，2-拒绝（第三阶段） |
| audit_remark | VARCHAR | 500 | NULL | - | 审核备注（第三阶段） |
| published_at | DATETIME | - | NULL | - | 发布时间 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_articles_user_id` (`user_id`)
- INDEX `idx_articles_category_id` (`category_id`)
- INDEX `idx_articles_status` (`status`)
- INDEX `idx_articles_published_at` (`published_at`)
- INDEX `idx_articles_view_count` (`view_count`)
- INDEX `idx_articles_created_at` (`created_at`)
- INDEX `idx_articles_deleted_at` (`deleted_at`)
- INDEX `idx_articles_user_status` (`user_id`, `status`)
- INDEX `idx_articles_category_status` (`category_id`, `status`)
- UNIQUE KEY `uk_articles_slug` (`slug`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`category_id`) REFERENCES `categories`(`id`) ON DELETE SET NULL

**备注：**
- `slug` 字段用于SEO友好的URL，需唯一（NULL值不参与唯一性约束，允许多个NULL值）
- `audit_status` 和 `audit_remark` 字段为第三阶段预留
- `is_top` 字段预留，用于文章置顶功能
- `idx_articles_user_status` 组合索引用于优化用户文章列表查询
- `idx_articles_category_status` 组合索引用于优化分类文章列表查询

#### 4.2.4 article_tags（文章标签关联表）

**表说明：** 文章和标签的多对多关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| article_id | BIGINT | - | NOT NULL | - | 文章ID |
| tag_id | BIGINT | - | NOT NULL | - | 标签ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_article_tags_article_tag` (`article_id`, `tag_id`)
- INDEX `idx_article_tags_tag_id` (`tag_id`)
- FOREIGN KEY (`article_id`) REFERENCES `articles`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`tag_id`) REFERENCES `tags`(`id`) ON DELETE CASCADE

#### 4.2.5 questions（问题表）

**表说明：** 存储问题信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 提问者ID |
| title | VARCHAR | 100 | NOT NULL | - | 问题标题 |
| description | TEXT | - | NOT NULL | - | 问题描述（Markdown） |
| best_answer_id | BIGINT | - | NULL | - | 最佳回答ID |
| related_article_id | BIGINT | - | NULL | - | 关联文章ID |
| view_count | INT | - | NOT NULL | 0 | 查看数 |
| answer_count | INT | - | NOT NULL | 0 | 回答数 |
| follow_count | INT | - | NOT NULL | 0 | 关注数 |
| status | TINYINT | - | NOT NULL | 1 | 状态：0-已删除，1-正常 |
| audit_status | TINYINT | - | NOT NULL | 1 | 审核状态：0-待审核，1-通过，2-拒绝（第三阶段） |
| audit_remark | VARCHAR | 500 | NULL | - | 审核备注（第三阶段） |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_questions_user_id` (`user_id`)
- INDEX `idx_questions_best_answer_id` (`best_answer_id`)
- INDEX `idx_questions_related_article_id` (`related_article_id`)
- INDEX `idx_questions_answer_count` (`answer_count`)
- INDEX `idx_questions_created_at` (`created_at`)
- INDEX `idx_questions_deleted_at` (`deleted_at`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`related_article_id`) REFERENCES `articles`(`id`) ON DELETE SET NULL
- **注意：** `best_answer_id` 的外键约束在 `answers` 表创建后通过 `ALTER TABLE` 添加

**备注：**
- `related_article_id` 用于关联到某篇文章
- `audit_status` 和 `audit_remark` 字段为第三阶段预留
- 由于 `answers` 表在 `questions` 表之后创建，`best_answer_id` 的外键约束需在 `answers` 表创建后添加

#### 4.2.6 question_tags（问题标签关联表）

**表说明：** 问题和标签的多对多关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| question_id | BIGINT | - | NOT NULL | - | 问题ID |
| tag_id | BIGINT | - | NOT NULL | - | 标签ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_question_tags_question_tag` (`question_id`, `tag_id`)
- INDEX `idx_question_tags_tag_id` (`tag_id`)
- FOREIGN KEY (`question_id`) REFERENCES `questions`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`tag_id`) REFERENCES `tags`(`id`) ON DELETE CASCADE

#### 4.2.7 question_follows（问题关注表）

**表说明：** 存储用户对问题的关注关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| question_id | BIGINT | - | NOT NULL | - | 问题ID |
| user_id | BIGINT | - | NOT NULL | - | 关注用户ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_question_follow_user` (`question_id`, `user_id`)
- INDEX `idx_question_follows_question_id` (`question_id`)
- INDEX `idx_question_follows_user_id` (`user_id`)
- FOREIGN KEY (`question_id`) REFERENCES `questions`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 每个用户对同一问题只能关注一次
- `question_id` 与 `user_id` 的组合唯一，便于快速判断关注状态

#### 4.2.8 answers（回答表）

**表说明：** 存储回答信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| question_id | BIGINT | - | NOT NULL | - | 问题ID |
| user_id | BIGINT | - | NOT NULL | - | 回答者ID |
| content | TEXT | - | NOT NULL | - | 回答内容（Markdown） |
| upvote_count | INT | - | NOT NULL | 0 | 赞同数 |
| downvote_count | INT | - | NOT NULL | 0 | 反对数 |
| comment_count | INT | - | NOT NULL | 0 | 评论数 |
| is_best | TINYINT | - | NOT NULL | 0 | 是否最佳回答 |
| status | TINYINT | - | NOT NULL | 1 | 状态：0-已删除，1-正常 |
| audit_status | TINYINT | - | NOT NULL | 1 | 审核状态：0-待审核，1-通过，2-拒绝（第三阶段） |
| audit_remark | VARCHAR | 500 | NULL | - | 审核备注（第三阶段） |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_answers_question_id` (`question_id`)
- INDEX `idx_answers_user_id` (`user_id`)
- INDEX `idx_answers_is_best` (`is_best`)
- INDEX `idx_answers_upvote_count` (`upvote_count`)
- INDEX `idx_answers_created_at` (`created_at`)
- INDEX `idx_answers_deleted_at` (`deleted_at`)
- INDEX `idx_answers_question_is_best` (`question_id`, `is_best`)
- FOREIGN KEY (`question_id`) REFERENCES `questions`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- `audit_status` 和 `audit_remark` 字段为第三阶段预留
- `idx_answers_question_is_best` 组合索引用于优化查询问题的最佳回答

#### 4.2.9 answer_votes（回答投票表）

**表说明：** 存储用户对回答的投票记录

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| answer_id | BIGINT | - | NOT NULL | - | 回答ID |
| user_id | BIGINT | - | NOT NULL | - | 投票用户ID |
| vote_type | TINYINT | - | NOT NULL | - | 投票类型：1-赞同，2-反对 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_answer_votes_answer_user` (`answer_id`, `user_id`)
- INDEX `idx_answer_votes_user_id` (`user_id`)
- FOREIGN KEY (`answer_id`) REFERENCES `answers`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 每个用户对每个回答只能投票一次，可通过更新 `vote_type` 改变投票类型

---

### 4.3 互动模块

#### 4.3.1 comments（评论表）

**表说明：** 存储评论信息，支持对文章、回答、视频的评论

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| target_type | VARCHAR | 20 | NOT NULL | - | 目标类型：article/answer/video |
| target_id | BIGINT | - | NOT NULL | - | 目标ID |
| user_id | BIGINT | - | NOT NULL | - | 评论者ID |
| parent_id | BIGINT | - | NULL | - | 父评论ID（二级评论） |
| content | VARCHAR | 1000 | NOT NULL | - | 评论内容（Markdown） |
| like_count | INT | - | NOT NULL | 0 | 点赞数 |
| reply_count | INT | - | NOT NULL | 0 | 回复数 |
| is_pinned | TINYINT | - | NOT NULL | 0 | 是否置顶 |
| status | TINYINT | - | NOT NULL | 1 | 状态：0-已删除，1-正常 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_comments_target` (`target_type`, `target_id`)
- INDEX `idx_comments_user_id` (`user_id`)
- INDEX `idx_comments_parent_id` (`parent_id`)
- INDEX `idx_comments_created_at` (`created_at`)
- INDEX `idx_comments_deleted_at` (`deleted_at`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`parent_id`) REFERENCES `comments`(`id`) ON DELETE CASCADE

**备注：**
- `target_type` 和 `target_id` 组合索引用于快速查询某内容的所有评论
- `parent_id` 为NULL表示主评论，有值表示回复评论

#### 4.3.2 likes（点赞表）

**表说明：** 存储点赞记录，支持对文章、回答、评论、视频的点赞

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| target_type | VARCHAR | 20 | NOT NULL | - | 目标类型：article/answer/comment/video |
| target_id | BIGINT | - | NOT NULL | - | 目标ID |
| user_id | BIGINT | - | NOT NULL | - | 点赞用户ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_likes_target_user` (`target_type`, `target_id`, `user_id`)
- INDEX `idx_likes_user_id` (`user_id`)
- INDEX `idx_likes_target` (`target_type`, `target_id`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 唯一索引确保每个用户对同一内容只能点赞一次
- 取消点赞时删除记录

#### 4.3.3 favorite_folders（收藏夹表）

**表说明：** 存储用户创建的收藏夹

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 用户ID |
| name | VARCHAR | 50 | NOT NULL | - | 收藏夹名称 |
| description | VARCHAR | 200 | NULL | - | 收藏夹描述 |
| sort_order | INT | - | NOT NULL | 0 | 排序顺序 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_favorite_folders_user_id` (`user_id`)
- INDEX `idx_favorite_folders_deleted_at` (`deleted_at`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

#### 4.3.4 favorites（收藏表）

**表说明：** 存储收藏记录，支持对文章、回答的收藏

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| target_type | VARCHAR | 20 | NOT NULL | - | 目标类型：article/answer |
| target_id | BIGINT | - | NOT NULL | - | 目标ID |
| user_id | BIGINT | - | NOT NULL | - | 收藏用户ID |
| folder_id | BIGINT | - | NULL | - | 收藏夹ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_favorites_target_user` (`target_type`, `target_id`, `user_id`)
- INDEX `idx_favorites_user_id` (`user_id`)
- INDEX `idx_favorites_folder_id` (`folder_id`)
- INDEX `idx_favorites_target` (`target_type`, `target_id`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`folder_id`) REFERENCES `favorite_folders`(`id`) ON DELETE SET NULL

**备注：**
- 唯一索引确保每个用户对同一内容只能收藏一次
- `folder_id` 为NULL表示默认收藏夹

#### 4.3.5 shares（分享表）

**表说明：** 存储分享记录

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| target_type | VARCHAR | 20 | NOT NULL | - | 目标类型：article/answer/video |
| target_id | BIGINT | - | NOT NULL | - | 目标ID |
| user_id | BIGINT | - | NULL | - | 分享用户ID（可为NULL，匿名分享） |
| share_platform | VARCHAR | 20 | NULL | - | 分享平台：wechat/weibo/qq/link |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_shares_target` (`target_type`, `target_id`)
- INDEX `idx_shares_user_id` (`user_id`)
- INDEX `idx_shares_created_at` (`created_at`)

**备注：**
- `user_id` 可为NULL，支持匿名分享统计

---

### 4.4 社交模块

#### 4.4.1 follows（关注表）

**表说明：** 存储用户关注关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| follower_id | BIGINT | - | NOT NULL | - | 关注者ID |
| following_id | BIGINT | - | NOT NULL | - | 被关注者ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_follows_follower_following` (`follower_id`, `following_id`)
- INDEX `idx_follows_follower_id` (`follower_id`)
- INDEX `idx_follows_following_id` (`following_id`)
- FOREIGN KEY (`follower_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`following_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 唯一索引防止重复关注
- 不能关注自己（需在应用层校验）

#### 4.4.2 notifications（通知表）

**表说明：** 存储系统通知

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 接收用户ID |
| type | VARCHAR | 50 | NOT NULL | - | 通知类型：comment/reply/like/follow/answer/adopt/invite |
| title | VARCHAR | 100 | NOT NULL | - | 通知标题 |
| content | VARCHAR | 500 | NULL | - | 通知内容 |
| target_type | VARCHAR | 20 | NULL | - | 目标类型：article/answer/comment/question |
| target_id | BIGINT | - | NULL | - | 目标ID |
| sender_id | BIGINT | - | NULL | - | 发送者ID |
| is_read | TINYINT | - | NOT NULL | 0 | 是否已读：0-未读，1-已读 |
| read_at | DATETIME | - | NULL | - | 阅读时间 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_notifications_user_id` (`user_id`)
- INDEX `idx_notifications_is_read` (`is_read`)
- INDEX `idx_notifications_created_at` (`created_at`)
- INDEX `idx_notifications_user_read` (`user_id`, `is_read`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`sender_id`) REFERENCES `users`(`id`) ON DELETE SET NULL

**备注：**
- 通知类型包括：comment（评论）、reply（回复）、like（点赞）、follow（关注）、answer（回答）、adopt（采纳）、invite（邀请）
- `idx_notifications_user_read` 组合索引用于优化查询用户未读通知

---

### 4.5 视频模块（第二阶段）

#### 4.5.1 videos（视频表）

**表说明：** 存储视频信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 作者ID |
| title | VARCHAR | 100 | NOT NULL | - | 视频标题 |
| description | TEXT | - | NULL | - | 视频简介（Markdown） |
| cover_image | VARCHAR | 500 | NULL | - | 封面图URL |
| category_id | BIGINT | - | NULL | - | 分类ID |
| related_article_id | BIGINT | - | NULL | - | 关联文章ID |
| file_path | VARCHAR | 500 | NULL | - | 原始文件路径 |
| file_size | BIGINT | - | NULL | - | 文件大小（字节） |
| duration | INT | - | NULL | - | 视频时长（秒） |
| hls_url_1080p | VARCHAR | 500 | NULL | - | 1080p HLS URL |
| hls_url_720p | VARCHAR | 500 | NULL | - | 720p HLS URL |
| hls_url_480p | VARCHAR | 500 | NULL | - | 480p HLS URL |
| transcode_status | TINYINT | - | NOT NULL | 0 | 转码状态：0-等待中，1-转码中，2-完成，3-失败 |
| status | TINYINT | - | NOT NULL | 0 | 状态：0-草稿，1-已发布，2-私密 |
| view_count | INT | - | NOT NULL | 0 | 播放量 |
| like_count | INT | - | NOT NULL | 0 | 点赞数 |
| comment_count | INT | - | NOT NULL | 0 | 评论数 |
| favorite_count | INT | - | NOT NULL | 0 | 收藏数 |
| share_count | INT | - | NOT NULL | 0 | 分享数 |
| audit_status | TINYINT | - | NOT NULL | 1 | 审核状态：0-待审核，1-通过，2-拒绝（第三阶段） |
| audit_remark | VARCHAR | 500 | NULL | - | 审核备注（第三阶段） |
| published_at | DATETIME | - | NULL | - | 发布时间 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_videos_user_id` (`user_id`)
- INDEX `idx_videos_category_id` (`category_id`)
- INDEX `idx_videos_status` (`status`)
- INDEX `idx_videos_transcode_status` (`transcode_status`)
- INDEX `idx_videos_published_at` (`published_at`)
- INDEX `idx_videos_view_count` (`view_count`)
- INDEX `idx_videos_created_at` (`created_at`)
- INDEX `idx_videos_deleted_at` (`deleted_at`)
- INDEX `idx_videos_user_status` (`user_id`, `status`)
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`category_id`) REFERENCES `categories`(`id`) ON DELETE SET NULL
- FOREIGN KEY (`related_article_id`) REFERENCES `articles`(`id`) ON DELETE SET NULL

**备注：**
- `transcode_status` 用于跟踪视频转码进度
- `audit_status` 和 `audit_remark` 字段为第三阶段预留
- `idx_videos_user_status` 组合索引用于优化用户视频列表查询

#### 4.5.2 video_tags（视频标签关联表）

**表说明：** 视频和标签的多对多关系

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| video_id | BIGINT | - | NOT NULL | - | 视频ID |
| tag_id | BIGINT | - | NOT NULL | - | 标签ID |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_video_tags_video_tag` (`video_id`, `tag_id`)
- INDEX `idx_video_tags_tag_id` (`tag_id`)
- FOREIGN KEY (`video_id`) REFERENCES `videos`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`tag_id`) REFERENCES `tags`(`id`) ON DELETE CASCADE

#### 4.5.3 danmaku（弹幕表）

**表说明：** 存储视频弹幕信息

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| video_id | BIGINT | - | NOT NULL | - | 视频ID |
| user_id | BIGINT | - | NULL | - | 用户ID（可为NULL，匿名弹幕） |
| content | VARCHAR | 50 | NOT NULL | - | 弹幕内容 |
| time | DECIMAL | 10,2 | NOT NULL | - | 弹幕时间（秒） |
| color | VARCHAR | 20 | NOT NULL | '#FFFFFF' | 弹幕颜色 |
| position | TINYINT | - | NOT NULL | 0 | 位置：0-滚动，1-顶部，2-底部 |
| font_size | TINYINT | - | NOT NULL | 25 | 字体大小（预留） |
| status | TINYINT | - | NOT NULL | 1 | 状态：0-已删除，1-正常 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| deleted_at | DATETIME | - | NULL | - | 删除时间（软删除） |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_danmaku_video_id` (`video_id`)
- INDEX `idx_danmaku_video_time` (`video_id`, `time`)
- INDEX `idx_danmaku_user_id` (`user_id`)
- INDEX `idx_danmaku_deleted_at` (`deleted_at`)
- FOREIGN KEY (`video_id`) REFERENCES `videos`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE SET NULL

**备注：**
- `video_id` 和 `time` 组合索引用于快速查询某时间段的弹幕
- `user_id` 可为NULL，支持匿名弹幕

#### 4.5.4 video_play_records（视频播放记录表）

**表说明：** 存储视频播放记录，用于续播和统计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| video_id | BIGINT | - | NOT NULL | - | 视频ID |
| user_id | BIGINT | - | NULL | - | 用户ID（可为NULL，访客播放） |
| play_progress | INT | - | NOT NULL | 0 | 播放进度（秒） |
| play_duration | INT | - | NOT NULL | 0 | 播放时长（秒） |
| is_completed | TINYINT | - | NOT NULL | 0 | 是否播放完成 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_video_play_records_video_id` (`video_id`)
- INDEX `idx_video_play_records_user_id` (`user_id`)
- INDEX `idx_video_play_records_video_user` (`video_id`, `user_id`)
- FOREIGN KEY (`video_id`) REFERENCES `videos`(`id`) ON DELETE CASCADE
- FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE SET NULL

**备注：**
- 每个用户对每个视频只保留一条最新记录，通过更新实现
- `user_id` 可为NULL，用于统计访客播放
- **注意：** 由于 `user_id` 可能为NULL，无法使用唯一索引约束，需要在应用层确保：当 `user_id` 不为NULL时，每个用户每个视频只有一条记录

---

### 4.6 系统模块

#### 4.6.1 search_logs（搜索日志表）

**表说明：** 存储搜索记录，用于搜索统计和推荐

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NULL | - | 用户ID（可为NULL，访客搜索） |
| keyword | VARCHAR | 100 | NOT NULL | - | 搜索关键词 |
| result_count | INT | - | NOT NULL | 0 | 结果数量 |
| search_type | VARCHAR | 20 | NULL | - | 搜索类型：all/article/question/video/user |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_search_logs_keyword` (`keyword`)
- INDEX `idx_search_logs_user_id` (`user_id`)
- INDEX `idx_search_logs_created_at` (`created_at`)

**备注：**
- 此表为可选表，用于搜索分析和热门搜索词统计

#### 4.6.2 system_config（系统配置表）

**表说明：** 存储系统配置参数（第三阶段）

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| config_key | VARCHAR | 100 | NOT NULL | - | 配置键（唯一） |
| config_value | TEXT | - | NULL | - | 配置值 |
| config_type | VARCHAR | 20 | NOT NULL | 'string' | 配置类型：string/number/boolean/json |
| description | VARCHAR | 200 | NULL | - | 配置描述 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_system_config_key` (`config_key`)

**备注：**
- 此表为第三阶段预留，用于系统参数配置

#### 4.6.3 admin_operations（管理员操作日志表）

**表说明：** 存储超级管理员的操作日志（第三阶段）

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| admin_id | BIGINT | - | NOT NULL | - | 管理员ID |
| operation_type | VARCHAR | 50 | NOT NULL | - | 操作类型：audit/delete/ban/unban等 |
| target_type | VARCHAR | 20 | NULL | - | 目标类型：user/article/question/answer/video |
| target_id | BIGINT | - | NULL | - | 目标ID |
| operation_desc | VARCHAR | 500 | NULL | - | 操作描述 |
| ip_address | VARCHAR | 50 | NULL | - | IP地址 |
| created_at | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_admin_operations_admin_id` (`admin_id`)
- INDEX `idx_admin_operations_target` (`target_type`, `target_id`)
- INDEX `idx_admin_operations_created_at` (`created_at`)
- FOREIGN KEY (`admin_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**备注：**
- 此表为第三阶段预留，用于记录管理员操作，便于审计

---

## 5. 索引设计

### 5.1 索引设计原则

1. **主键索引：** 所有表都有自增主键
2. **唯一索引：** 用于保证数据唯一性（用户名、邮箱等）
3. **外键索引：** 所有外键字段都建立索引
4. **查询索引：** 根据常用查询场景建立组合索引
5. **排序索引：** 对经常用于排序的字段建立索引

### 5.2 主要查询场景索引

#### 5.2.1 用户相关查询
- `users.username` - 登录查询
- `users.status` - 状态筛选
- `users.created_at` - 注册时间排序

#### 5.2.2 内容相关查询
- `articles.user_id + articles.status` - 用户文章列表（组合索引：`idx_articles_user_status`）
- `articles.category_id + articles.status` - 分类文章列表（组合索引：`idx_articles_category_status`）
- `articles.published_at` - 时间排序
- `articles.view_count` - 热度排序
- `questions.answer_count` - 回答数排序
- `answers.question_id + answers.is_best` - 问题的最佳回答（组合索引：`idx_answers_question_is_best`）
- `answers.upvote_count` - 赞同数排序

#### 5.2.3 互动相关查询
- `comments.target_type + target_id` - 某内容的评论列表
- `likes.target_type + target_id` - 某内容的点赞列表
- `favorites.user_id` - 用户的收藏列表

#### 5.2.4 社交相关查询
- `follows.follower_id` - 用户的关注列表
- `follows.following_id` - 用户的粉丝列表
- `notifications.user_id + is_read` - 用户未读通知（组合索引：`idx_notifications_user_read`）

### 5.3 索引优化建议

1. **避免过度索引：** 索引会降低写入性能，需权衡
2. **定期分析：** 使用 `EXPLAIN` 分析查询计划
3. **监控慢查询：** 定期检查慢查询日志
4. **组合索引顺序：** 将选择性高的字段放在前面
5. **软删除索引：** 所有包含 `deleted_at` 字段的表都添加了索引，用于优化软删除查询
6. **组合索引优化：** 针对常用查询场景添加了组合索引，如用户文章列表、分类文章列表、未读通知等

---

## 6. 预留扩展说明

### 6.1 第一阶段预留字段

- `users.email`, `users.phone` - 用户联系方式（预留）
- `categories.parent_id`, `categories.icon` - 分类扩展（预留）
- `articles.is_top` - 文章置顶（预留）

### 6.2 第二阶段预留字段

- 所有视频相关表（第二阶段开发）
- `videos` 表的转码相关字段
- `danmaku` 表的弹幕相关字段

### 6.3 第三阶段预留字段

- `users.status`, `users.role` - 用户状态和角色
- `articles.audit_status`, `articles.audit_remark` - 审核相关
- `questions.audit_status`, `questions.audit_remark` - 审核相关
- `answers.audit_status`, `answers.audit_remark` - 审核相关
- `videos.audit_status`, `videos.audit_remark` - 审核相关
- `system_config` 表 - 系统配置
- `admin_operations` 表 - 管理员操作日志

### 6.4 未来扩展建议

1. **多级分类：** `categories.parent_id` 已预留
2. **内容版本：** 可添加 `article_versions` 表记录编辑历史
3. **内容草稿：** 当前使用 `status=0` 表示草稿，可扩展为独立表
4. **内容审核流程：** 可添加 `audit_logs` 表记录审核历史
5. **用户积分系统：** 可添加 `user_points` 表
6. **内容打赏：** 可添加 `rewards` 表
7. **内容付费：** 可添加 `payments` 表

---

## 7. 数据库初始化脚本

### 7.1 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS corasta DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE corasta;
```

### 7.2 表创建顺序

建议按以下顺序创建表，避免外键依赖问题：

1. `users`
2. `categories`
3. `tags`
4. `user_privacy_settings`
5. `security_questions`
6. `articles`
7. `article_tags`
8. `questions`
9. `question_tags`
10. `answers`
11. `answer_votes`
12. `comments`
13. `likes`
14. `favorite_folders`
15. `favorites`
16. `shares`
17. `follows`
18. `notifications`
19. `videos`（第二阶段）
20. `video_tags`（第二阶段）
21. `danmaku`（第二阶段）
22. `video_play_records`（第二阶段）
23. `search_logs`（可选）
24. `system_config`（第三阶段）
25. `admin_operations`（第三阶段）

---

## 8. 数据字典

### 8.1 状态枚举值

#### 用户状态（users.status）
- `0` - 封禁
- `1` - 正常

#### 用户角色（users.role）
- `0` - 普通用户
- `1` - 超级管理员

#### 内容状态（articles.status, videos.status）
- `0` - 草稿
- `1` - 已发布
- `2` - 私密

#### 审核状态（audit_status）
- `0` - 待审核
- `1` - 通过
- `2` - 拒绝

#### 转码状态（videos.transcode_status）
- `0` - 等待中
- `1` - 转码中
- `2` - 完成
- `3` - 失败

#### 投票类型（answer_votes.vote_type）
- `1` - 赞同
- `2` - 反对

#### 弹幕位置（danmaku.position）
- `0` - 滚动
- `1` - 顶部
- `2` - 底部

#### 通知类型（notifications.type）
- `comment` - 评论
- `reply` - 回复
- `like` - 点赞
- `follow` - 关注
- `answer` - 回答
- `adopt` - 采纳
- `invite` - 邀请

#### 目标类型（target_type）
- `article` - 文章
- `answer` - 回答
- `comment` - 评论
- `video` - 视频
- `question` - 问题

---

## 9. 性能优化建议

### 9.1 查询优化

1. **分页查询：** 使用 `LIMIT` 和 `OFFSET`，避免全表扫描
2. **避免 SELECT \*：** 只查询需要的字段
3. **使用 EXPLAIN：** 分析查询计划，优化慢查询
4. **合理使用缓存：** 对热点数据进行缓存

### 9.2 写入优化

1. **批量插入：** 使用 `INSERT INTO ... VALUES (...), (...), (...)`
2. **延迟更新：** 对统计字段（如点赞数）使用异步更新
3. **软删除：** 使用 `deleted_at` 字段，避免物理删除

### 9.3 表结构优化

1. **字段类型选择：** 根据数据范围选择合适的类型
2. **避免 TEXT 类型：** 除非必要，使用 VARCHAR
3. **合理使用索引：** 避免过多索引影响写入性能

---

## 10. 数据备份与恢复

### 10.1 备份策略

1. **全量备份：** 每日凌晨进行全量备份
2. **增量备份：** 每小时进行增量备份
3. **日志备份：** 开启 binlog，支持时间点恢复

### 10.2 恢复策略

1. **全量恢复：** 从全量备份恢复
2. **增量恢复：** 从全量备份 + 增量备份恢复
3. **时间点恢复：** 从全量备份 + binlog 恢复到指定时间点

---

**文档结束**

